# ğŸ§ª Ground-Lora Test Suite

This directory contains comprehensive unit tests for the Ground-Lora project using PlatformIO Test Runner.

## ğŸ¯ Test Structure

### ğŸ“‚ Test Categories

#### ğŸ› ï¸ **test_utilities/**
- Basic Arduino utility functions (map, constrain, abs)
- Timing and overflow handling
- Mathematical operations validation

#### ğŸ“¡ **test_lora/**
- LoRa communication protocol testing
- Message construction and validation  
- Checksum calculation verification
- Control surface mapping tests
- Engine throttle mapping validation

#### ğŸ® **test_ps5/**
- PS5 controller input processing
- Analog stick and trigger handling
- Button mapping and emergency controls
- Trim and flaps control logic
- Battery level reporting

#### ğŸ–¥ï¸ **test_display/**
- OLED display functionality  
- Control surface value ranges
- Battery and status display logic
- Frame animation and coordinates
- Emergency indicator testing

#### ğŸ›¡ï¸ **test_safety/**
- Emergency stop systems
- Control surface safety limits
- Rate limiting and input validation
- Connection loss safety protocols
- Airbrake and trim reset safety

#### ğŸ”„ **test_integration/**
- Complete system workflow testing
- Subsystem communication validation
- End-to-end control loop simulation
- State consistency verification
- Real-world scenario testing

#### ğŸš€ **test_main/**
- System initialization sequence
- Main loop execution logic
- Timing and performance validation
- Resource management testing
- Error handling scenarios

## ğŸƒâ€â™‚ï¸ Running Tests

### All Tests
```bash
pio test
```

### Specific Test Suite
```bash
pio test -f test_lora
pio test -f test_ps5
pio test -f test_safety
```

### With Verbose Output
```bash
pio test -v
```

## ğŸ“Š Test Coverage

The test suite covers:
- âœ… **Core Functionality**: All major system components
- âœ… **Safety Systems**: Emergency stops, limits, validation  
- âœ… **Communication**: LoRa protocol and PS5 integration
- âœ… **Edge Cases**: Overflow, bounds checking, error handling
- âœ… **Integration**: Complete system workflows
- âœ… **Performance**: Timing and resource management

## ğŸ¯ Test Philosophy

- **ğŸ”’ Safety First**: Comprehensive safety system testing
- **ğŸ“¡ Protocol Validation**: Thorough communication testing
- **ğŸ® User Experience**: Controller interaction validation  
- **âš¡ Performance**: Timing and efficiency verification
- **ğŸ›¡ï¸ Robustness**: Edge case and error handling

## ğŸ’¡ Adding New Tests

1. Create test file in appropriate category directory
2. Include `<unity.h>` and required headers
3. Implement `setUp()` and `tearDown()` functions
4. Write test functions with `test_` prefix
5. Use Unity assertions (TEST_ASSERT_*)
6. Add tests to setup() with RUN_TEST()

### Example Test Function
```cpp
void test_example_functionality() {
    // Arrange
    int input = 127;
    
    // Act  
    int result = map(input, 0, 255, 0, 180);
    
    // Assert
    TEST_ASSERT_EQUAL(90, result);
}
```

## ğŸ“ˆ Test Results

Tests validate:
- ğŸ® **Controller Integration**: Input processing and mapping
- ğŸ“¡ **Communication Protocol**: Message format and checksums
- ğŸ›¡ï¸ **Safety Systems**: Emergency stops and limits
- ğŸ–¥ï¸ **Display Logic**: Status and control feedback
- âš¡ **System Performance**: Timing and resource usage
- ğŸ”„ **Complete Workflows**: End-to-end functionality

---

For more information about PlatformIO Unit Testing:
- https://docs.platformio.org/en/latest/advanced/unit-testing/index.html
